<p-table
  #dt
  [value]="users()"
  [lazy]="true"
  [lazyLoadOnInit]="false"
  (onLazyLoad)="onLazyLoad($event)"
  [paginator]="existsUsers()"
  [rows]="10"
  [totalRecords]="pagination()?.total || 0"
  [loading]="isLoading()"
  [showCurrentPageReport]="true"
  currentPageReportTemplate="Showing {first} to {last} of {totalRecords} residents"
  [rowsPerPageOptions]="[10, 20, 50]"
>
  <ng-template pTemplate="caption">
    <div class="flex flex-col sm:flex-row justify-between items-center gap-4">
      <h3 class="text-lg font-bold text-slate-800">Resident List</h3>
      <div class="flex items-center gap-3 w-full sm:w-auto">
        <span class="p-input-icon-left w-full sm:w-64">
          <input
            pInputText
            class="w-full"
            placeholder="Search by name or email..."
            (input)="dt.filterGlobal($any($event.target).value, 'contains')"
          />
        </span>
        <p-button
          label="Add Resident"
          icon="pi pi-plus"
          severity="secondary"
          (click)="addUser()"
        />
      </div>
    </div>
  </ng-template>

  <ng-template #header>
    @if(existsUsers()){
    <tr>
      <th class="w-16 text-center">Status</th>
      <th>Resident</th>
      <th>Role</th>
      <th>Vehicle Information</th>
      <th>Spot</th>
      <th>Created By</th>
      <th class="text-center">Actions</th>
    </tr>
    }
  </ng-template>

  <ng-template #body let-user>
    <tr class="hover:bg-blue-50/30 transition-colors">
      <td class="text-center">
        <span
          class="inline-block size-3 rounded-full"
          [class.bg-emerald-500]="user.isActive"
          [class.bg-amber-500]="!user.isActive"
        >
          <span class="sr-only"
            >{{ user.isActive ? 'Active' : 'Inactive' }}</span
          >
        </span>
      </td>
      <td>
        <div class="flex flex-col">
          <span class="font-bold text-slate-700">{{ user.fullName }}</span>
          <span class="text-xs text-slate-400">{{ user.email }}</span>
        </div>
      </td>
      <td><app-role-tag [role]="user.role" /></td>
      <td>
        @if (user.vehiclePlate) {
        <div class="flex flex-col text-xs">
          <span class="font-medium text-slate-600"
            >{{ user.vehicleDescription }}</span
          >
          <span class="font-mono text-blue-600">{{ user.vehiclePlate }}</span>
        </div>
        } @else {
        <span class="text-slate-300 italic text-xs">No vehicle registered</span>
        }
      </td>
      <td class="font-mono font-bold">{{ user.assignedSlotNumber || '-' }}</td>
      <td class="text-slate-400">{{ user.createdBy?.fullName || '--' }}</td>
      <td>
        <div class="flex justify-center gap-1">
          <p-button
            icon="pi pi-pencil"
            text
            rounded
            severity="secondary"
            (click)="updateUser(user)"
            pTooltip="Edit resident"
          />
          <p-button
            icon="pi pi-trash"
            text
            rounded
            severity="danger"
            pTooltip="Delete resident"
            (click)="deleteUser(user)"
          />
        </div>
      </td>
    </tr>
  </ng-template>

  <ng-template #emptymessage>
    <tr>
      <td colspan="7" class="text-center py-8 text-slate-400">
        <i class="pi pi-user text-4xl mb-3 block"></i>
        No users found. Click "Add Resident" to start.
      </td>
    </tr>
  </ng-template>
</p-table>
