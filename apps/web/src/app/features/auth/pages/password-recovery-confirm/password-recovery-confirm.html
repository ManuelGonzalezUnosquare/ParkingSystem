<div class="flex flex-col animate-fade-in">
  <header class="flex flex-col items-center mb-8">
    <div
      class="size-16 bg-primary/10 rounded-full flex items-center justify-center mb-4 text-primary"
    >
      <span class="material-symbols-outlined text-4xl">
        {{ step() === 1 ? ' domain_verification' : 'lock_open' }}
      </span>
    </div>
    <h1
      class="text-[#0d141c] tracking-light text-[32px] font-bold leading-tight text-center"
    >
      {{ step() === 1 ? 'Verify Recovery Code' : 'Set New Password' }}
    </h1>
    <p
      class="text-[#4b739b] text-base font-normal leading-normal text-center mt-3 max-w-87.5"
    >
      {{ step() === 1 ? 'Enter the 8-character code we sent to your email to
      continue.' : 'Great! Now create a strong password for your account.' }}
    </p>
  </header>

  @if(step() === 1){
  <form
    class="flex flex-col gap-4"
    [formGroup]="codeForm"
    (ngSubmit)="doSubmitCode()"
  >
    <div class="form-control">
      <label class="form-label" for="code">Recovery Code</label>
      <input
        fluid
        pInputText
        formControlName="code"
        id="code"
        placeholder="Enter 8-digit code"
        class="font-mono uppercase text-center tracking-widest"
        [invalid]="codeForm.controls.code.invalid && codeForm.controls.code.touched"
      />
      <app-form-validation-error
        [touched]="codeForm.controls.code.touched"
        [errors]="codeForm.controls.code.errors"
        label="Recovery Code"
      />
    </div>

    <app-form-feedback [callState]="store.callState()" />

    <div class="pt-4 flex flex-col gap-3">
      <p-button
        type="submit"
        label="Verify Code"
        fluid
        [loading]="store.loading()"
      />
      <p-button
        link
        label="Back to Login"
        icon="pi pi-arrow-left"
        [routerLink]="['/auth/login']"
      />
    </div>
  </form>
  } @else {
  <form
    class="flex flex-col gap-4"
    [formGroup]="passwordForm"
    (ngSubmit)="doSubmitPassword()"
  >
    <div class="form-control">
      <label class="form-label" for="password">New Password</label>
      <input
        fluid
        pInputText
        type="password"
        formControlName="password"
        id="password"
        placeholder="********"
        [invalid]="passwordForm.controls.password.invalid && passwordForm.controls.password.touched"
      />
      <app-form-validation-error
        [touched]="passwordForm.controls.password.touched"
        [errors]="passwordForm.controls.password.errors"
        label="Password"
      />
    </div>

    <div class="form-control">
      <label class="form-label" for="confirmPassword"
        >Confirm New Password</label
      >
      <input
        fluid
        pInputText
        type="password"
        formControlName="confirmPassword"
        id="confirmPassword"
        placeholder="********"
        [invalid]="passwordForm.controls.confirmPassword.invalid && passwordForm.controls.confirmPassword.touched"
      />
      <app-form-validation-error
        [touched]="passwordForm.controls.confirmPassword.touched"
        [errors]="passwordForm.controls.confirmPassword.errors"
        label="Confirm Password"
      />
    </div>

    <app-form-feedback [callState]="store.callState()" />

    <div class="pt-4 flex flex-col gap-3">
      <p-button
        type="submit"
        label="Reset Password"
        fluid
        [loading]="store.loading()"
      />
      <p-button link label="Cancel" (click)="step.set(1)" />
    </div>
  </form>
  }
</div>
